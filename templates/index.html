<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lesson Plan Assistant</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
      }
      .container {
        max-width: 800px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin-bottom: 20px;
      }
      .assistant,
      .user {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .assistant {
        background-color: #e3f2fd;
      }
      .user {
        background-color: #ffecb3;
        text-align: right;
      }
      .textarea-container {
        display: flex;
        margin-top: 10px;
      }
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
      }
      button {
        padding: 10px 15px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #45a049;
      }
      .output-section {
        border: 1px solid #ddd;
        padding: 10px;
        background-color: #f1f1f1;
        border-radius: 5px;
      }
      .hidden {
        display: none;
      }
      #loader {
        display: none;
        font-style: italic;
        color: gray;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="my-4">Future Makers Interview Assistant</h1>
        <div class="d-flex">
          <button
            class="btn btn-primary mr-2"
            onclick="showSection('InterviewSummary')"
          >
            Interview Summary
          </button>
        </div>
      </div>

      <h4>
        This project will prepare a lesson plan for making FutureMakers Spark,
        the flying machines that are tailored to the target grade of the
        learners. Also, assessment questions will be generated for the learners
        to evaluate their understanding of the subject matter.
      </h4>

      <!-- Interview Section -->
      <div class="section" id="interview-section">
        <h2>Interview</h2>
        <div id="chat-container">
          <!-- Dynamic chat messages will appear here -->
        </div>
        <p id="loader">Loading AI response ...</p>
        <div class="textarea-container">
          <textarea
            id="user-input"
            rows="2"
            placeholder="Type your answer here..."
          ></textarea>
          <button onclick="sendUserMessage()">Send</button>
        </div>
      </div>

      <!-- Lesson Plan Section -->
      <div class="section hidden" id="lesson-plan-section">
        <h2>Lesson Plan</h2>
        <div class="output-section" id="lesson-plan"></div>
      </div>

      <!-- Assessment Section -->
      <div class="section hidden" id="assessment-section">
        <h2>Assessment</h2>
        <div class="output-section" id="assessment"></div>
      </div>
    </div>

    <script>
      const apiResponse = {
        user: "",
        assistant:
          "Please tell me about your class: What grade level do you teach?",
        "lesson-plan": "",
        assessment: "",
      };

      const chatContainer = document.getElementById("chat-container");
      const loader = document.getElementById("loader");

      function renderChat(role, message) {
        const chatBubble = document.createElement("div");
        chatBubble.className = role;
        chatBubble.innerText = message;
        chatContainer.appendChild(chatBubble);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function sendUserMessage() {
        const userInput = document.getElementById("user-input");
        const userMessage = userInput.value.trim();
        if (!userMessage) return;

        renderChat("user", userMessage);
        userInput.value = ""; // Clear input

        loader.style.display = "block"; // Show loader

        fetch("https://karthikvibuthiportfolio.com/futuremakers/lesson-plan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ "interview-answers": userMessage }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(".json", data);
            console.log("JSON Parse", JSON.parse(data));
            console.log("user", JSON.parse(data).user);
            console.log("assistant", JSON.parse(data).assistant);

            loader.style.display = "none"; // Hide loader
            if (data.type === "assistant") {
              renderChat("assistant", data.message);
            }
            if (data.lessonplan) {
              document
                .getElementById("lesson-plan-section")
                .classList.remove("hidden");
              document.getElementById("lesson-plan").innerText =
                data.lessonplan;
            }
            if (data.assessment) {
              document
                .getElementById("assessment-section")
                .classList.remove("hidden");
              document.getElementById("assessment").innerText = data.assessment;
            }
          })
          .catch((err) => {
            loader.style.display = "none"; // Hide loader
            console.error("Error:", err);
          });
      }

      // Initial assistant prompt
      renderChat("assistant", apiResponse.assistant);
    </script>
  </body>
</html>
